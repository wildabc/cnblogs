<!DOCTYPE html>
<html lang="zh-cn" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="" />
	
	
	
	<title>重新ICP，在没有Matlab的日子里 ｜ 枣木夹子</title>
	
    
    
    <meta name="description" content="没时间写文字，先贴几张图：（Google spreadsheets链接，可能需翻墙） ======================================= 没想到在我没有加任何文字说明的情况下，这个帖子竟然在阅读" />
    

    

	
    
    <link rel="shortcut icon" href="wildabc.github.io/cnblogs/images/favicon.ico" />

    <link rel="stylesheet" type="text/css" media="screen" href="wildabc.github.io/cnblogs/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="wildabc.github.io/cnblogs/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="wildabc.github.io/cnblogs/css/highlight.css" />

    
    
    <link rel="stylesheet" href="wildabc.github.io/cnblogs/css/custom.css" />
    
</head>

<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="wildabc.github.io/cnblogs/posts/">总目</a>
            </li>
            
            <li>
                <a href="wildabc.github.io/cnblogs/tags/">标签</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="wildabc.github.io/cnblogs/">
                    <span>枣木夹子</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title"></p>
            <div class="my_socials">
                
                
                <a href="https://github.com/wildabc/" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="mailto:wildabc@qq.com" title="mail" target="_blank"><i class="ri-mail-fill"></i></a>
                
                
                <a href="" type="application/rss+xml" title="rss" target="_blank"><i
                        class="ri-rss-fill"></i></a>
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='wildabc.github.io/cnblogs/posts/%E9%87%8D%E6%96%B0icp%E5%9C%A8%E6%B2%A1%E6%9C%89matlab%E7%9A%84%E6%97%A5%E5%AD%90%E9%87%8C/'>重新ICP，在没有Matlab的日子里</a></h2>
                        <span class="date">2009.11.22</span>
                    </div>
                    <div class="post_content markdown">
<span>没时间写文字，先</span><span>贴几</span><span>张图：（</span><a target="_blank" href="https://spreadsheets.google.com/pub?key=tbd9fCal6wm3mJDSlOupfnw&amp;gid=0"><span>Google spreadsheets链接</span></a><span>，可能需翻墙）</span></p>
<p>=======================================</p>
<p>没想到在我没有加任何文字说明的情况下，这个帖子竟然在阅读数上列第一。 这也能看懂？我还是解释一下好了。这里所要探讨的是不同范数下的点云对齐问题。<br />
</p>
<p><a href="http://en.wikipedia.org/wiki/Iterative_Closest_Point" target="_blank">ICP</a>是Iterative Closest Point的缩写，更一般地也可以作为Iterative Corresponding Point的缩写，是处理点云对齐（或称点云匹配、配准，英语Pointcloud Registration）问题的方法。关于点云对齐和ICP，先上一些参考文献：&nbsp;</p>
<p>[1] Paul J. Besl and Neil D. Mckay. A method for registration of 3-d shapes. IEEE Transactions on Pattern Analysis and Machine Intelligence, 14(2):239&#8211;256, 1992.</p>
<p>[2] Yang Chen and G&#233;rard Medioni. Object modelling by registration of multiple range images. Image Vision Comput., 10(3):145&#8211;155, 1992.</p>
<p>[3] Szymon Rusinkiewicz and Marc Levoy. Efﬁcient variants of the ICP algorithm. In Third International Conference on 3D Digital Imaging and Modeling (3DIM), 2001. </p>
<p>[4] Timoth&#233;e Jost. Fast Geometric Matching for Shape Registration. PhD thesis, Universit&#233; de Neuch&#226;tel, 2002.&nbsp;</p>
<p>[5] Helmut Pottmann, Qi-Xing Huang, Yong-Liang Yang, and Shi-Min Hu. Geometry and convergence analysis of algorithms for registration of 3D shapes. Int. J. Computer Vision, 67(3):277&#8211;296, 2006.</p>
<p>再上一篇最新的，其中探讨了1范数在曲面拟合和点云对齐中的应用。我就是看了这篇，有了写这个帖子的想法。
</p>
<p>[6] S. Fl&#246;ry and M. Hofer. Surface Fitting and Registration of Point Clouds using Approximations of the Unsigned Distance Function. Computer Aided Geometric Design (CAGD), 27(1): 60-77, 2010.&nbsp;
</p>
<p>这些文章在谷歌上就可以搜到并下载，不需要任何商业数据库。</p>
<p>在点云对齐中，每个点到对齐目标都存在偏差，所有的偏差可组成一向量，不妨称作偏差向量。最常规的想法就是使偏差的平方和最小，如使用最小二乘法解回归问题，以前对点云对齐问题就是如此处理。用<a target="_blank" href="http://en.wikipedia.org/wiki/Vector_norm">向量范数</a>的语言来讲，这也就是令偏差向量的2范数最小。那么探讨其它范数的意义何在呢？基于1范数的优化有更好的稳健性，可以参看维基中的&#8220;<a href="http://en.wikipedia.org/wiki/Least_absolute_deviations" target="_blank">Least absolute deviations</a>&#8221;词条和文献[6]。而无穷大范数指示的是最大偏差绝对值，有重要的意义，例如在<a href="http://www.chinabaike.com/article/316/408/2007/20070507110563.html" target="_blank">形位公差</a>的评价中。</p><p>点到对齐目标的偏差有两种常用的评价方法：点到对应点的距离和点到对应点的切平面的距离。后一种通常有更快的收敛速度，但需要切平面的信息。在以点到点的距离为偏差评价的情形，基于1范数和无穷大范数的优化可转化为二次锥规划(<a href="http://en.wikipedia.org/wiki/Second-order_cone_programming" target="_blank">Second-Order Cone Programming</a>，SOCP)问题。而在以点到点的距离为偏差评价的情形，基于1范数和无穷大范数的优化可转化为线性规划(<a href="http://en.wikipedia.org/wiki/Linear_programming" target="_blank">Linear Programming</a>，LP)问题。文献[6]中有将基于1范数的优化进行转化的方法，而这方法很容易应用到无穷大范数的情况。之所以要这样转化，将无约束优化问题转为约束优化问题，我理解这是为了光滑性。原本基于1范数和无穷大范数的优化是非光滑的，转化后则成为光滑的约束优化问题。尽管增加了变量数，又加上了约束，但这都是值得的，可见光滑性在优化中有多重要。此外，我还实现了另两种方法：基于1范数的优化还有一种近似的解法，就是使用<a href="http://sepwww.stanford.edu/public/docs/sep103/antoine2/paper_html/node3.html" target="_blank">Huber函数</a>来作1范数的近似，然后用<a target="_blank" href="http://en.wikipedia.org/wiki/L-BFGS">LBFGS</a>来求解这一优化问题；而对于更一般的基于p范数优化，可以用<a href="http://en.wikipedia.org/wiki/Iteratively_reweighted_least_squares" target="_blank">IRLS</a>方法来近似求解。</p><p>我的开发环境是<a href="http://www.vim.org/" target="_blank">gVim</a>+<a href="http://www.tdragon.net/recentgcc/" target="_blank">TDM-MinGW</a>。各种工具包的选取如下，矩阵处理用的是<a href="http://eigen.tuxfamily.org/index.php?title=Main_Page" target="_blank">Eigen</a>，最近点搜索使用<a href="http://www.cs.umd.edu/%7Emount/ANN/" target="_blank">ANN</a>，LP求解使用<a href="http://gnuwin32.sourceforge.net/packages/glpk.htm" target="_blank">Glpk for Windows</a>。SOCP求解似乎只有商业化工具，我试了一下<a href="http://www.mosek.com/" target="_blank">Mosek</a>，不过它给出的解真是诡异，可能是我的能力还不够吧。试了几种方法之后，还是用了一种笨办法：将SOCP转为SDP(<a href="http://en.wikipedia.org/wiki/Semidefinite_programming" target="_blank">Semi-Definite Programming</a>，半正定规划)，将相关数据写出为<a href="http://sdpa.indsys.chuo-u.ac.jp/sdpa/files/sdpa.7.1.1.manual.20080618.pdf" target="_blank">sparse SDPA</a>格式的文件，再调用<a href="http://projects.coin-or.org/Csdp/" target="_blank">CSDP</a>来求解。基于<a href="http://sepwww.stanford.edu/public/docs/sep103/antoine2/paper_html/node3.html" target="_blank">Huber函数</a>的优化中用的<a target="_blank" href="http://en.wikipedia.org/wiki/L-BFGS">LBFGS</a>方法采用的是<a target="_blank" href="http://www.chokkan.org/software/liblbfgs/">libLBFGS</a>。是如果在Matlab下，问题就会简单些(推断，我也没实际验证)，矩阵处理自不必说。最近点搜索方面，ANN依然可用(<a href="http://webscripts.softpedia.com/script/Scientific-Engineering-Ruby/Mathematics/ANN-MATLAB-Wrapper-33976.html" target="_blank">ANN MATLAB Wrapper</a>)，我还用过<a href="http://www.mathworks.com/matlabcentral/fileexchange/21512-kd-tree-for-matlab" target="_blank">这个</a>。优化方面，Matlab本身就可解LP，而SOCP可用<span class="Apple-style-span" style="font-family: Arial; line-height: normal; font-size: 16px; border-collapse: collapse; white-space: pre;"><a href="http://sedumi.ie.lehigh.edu/" target="_blank">SeDuMi</a>。</span></p><p><span class="Apple-style-span" style="font-family: Arial; line-height: normal; font-size: 16px; border-collapse: collapse; white-space: pre;"></span></p>
<p>用一个小点云(约1400点)做了下测试，谈不上验证了什么。考虑了三种范数，所以有三张收敛图。作为纵座标的指标，1范数用的是平均绝对误差，2范数用的是均方根误差，无穷大范数用的是最大绝对误差(也就是无穷大范数本身)。图中各种方法名称的意义如下：</p>
<p>分为两大类，以P 开头的表示以点到点的距离为偏差评价方法，而以PL 开头的表示以点到平面的距离为偏差评价方法。后面的符号中，1表示1范数，2表示2范数，i表示无穷大范数，1H表示使用<a href="http://sepwww.stanford.edu/public/docs/sep103/antoine2/paper_html/node3.html" target="_blank">Huber函数</a>近似的1范数，RW(Re-Weighted)表示用<a href="http://en.wikipedia.org/wiki/Iteratively_reweighted_least_squares" target="_blank">IRLS</a>计算p范数优化，RW后跟的数字就是p的值。此外，以P 开头的方法中还有2T和RWT两种变体，它们在求解最优变换时不是采用的闭合解方法，而是像以点到平面的距离为目标时使用的无穷小变换(也就是用切空间，所以用T来标明这类变体)。其实倒不如说P2和PRW两个是另类，因为只有它们有闭合解方法。</p>
<p><img alt="" src="../../images/1-norm_convergence.png"/></p>
<br />
<p><img alt="" src="../../images/2-norm_convergence.png"/></p>
<br />
<p><img alt="" src="../../images/infinity-norm_convergence.png"/></p><p>然后是看图说话。基于1范数的优化是为了稳健性而提出的，但是计算量是个大问题。如果只是为了稳健性，使用加权的最小二乘法可能更好，因为不仅更快也更灵活。而使用<a href="http://sepwww.stanford.edu/public/docs/sep103/antoine2/paper_html/node3.html" target="_blank">Huber函数</a>来近似1范数正是为了减少计算量。在以点到点的距离为偏差评价的情况下，实验显示这一方法很成功，两者的收敛曲线是重合的(在图上找不到P1的曲线，因为它正好被P1H的给盖住)。但在以点到平面的距离为偏差评价的情况下，两者的收敛曲线不一致，而且PL1H的收敛比较糟糕，<a target="_blank" href="http://en.wikipedia.org/wiki/L-BFGS">LBFGS</a>搜索几乎都不成功。具体的原因我不清楚，不过我推测还是光滑性不够。基于无穷大范数的优化收敛速度则实在太慢。它对于对应性的要求应是很高的。在点云和目标距离还比较大时可以考虑先采用2范数进行迭代，后面再使用穷大范数。最后，很有趣的一点，在基于<a href="http://en.wikipedia.org/wiki/Iteratively_reweighted_least_squares" target="_blank">IRLS</a>的p范数优化中，使用高于2的p值常能获得比2范数优化更快的收敛速度。PRW3就明显快于P2，而PLRW5更是在前几个迭代步一骑绝尘，远超其它方法。不过PLRW5稳定性不够，最后没能收敛到0，而且之所以用5而不是3或4，正是这两种稳定性太糟。采用加权的ICP，以前的文献，如[3,4]中也介绍过了，但其中的加权方法大抵是对匹配性更好的点对以较高的权值。可在基于<a href="http://en.wikipedia.org/wiki/Iteratively_reweighted_least_squares" target="_blank">IRLS</a>的p范数(p&gt;2)优化中则相反，对匹配性较差的点对(点之间距离更大者)以较高的权值。而实验显示这样可以加速收敛，但会减少稳定性。其中的原理我觉得可以这样解释：匹配性较差的点更需要改善其匹配性，使用较高的权值可以令这些点更快地接近目标曲面，从而更快地改善匹配性；另一方面，利用匹配性较差的点对计算的最优变换可能是不&#8220;正确&#8221;的，进而使整个算法的结果不能正确地收敛。这说明在权值的选取上其实是存在着一个速度与稳定性的权衡，而这一点似乎前人并未提到。<br /></p><p>&nbsp;</p><p><span style="font-size: 14pt;"></span><a target="_blank" href="../../files/icp.zip"><span style="font-size: 14pt;">源代码</span> </a><br /></p></div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="wildabc.github.io/cnblogs/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/">计算机图形学</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                
                <div class="doc_comments"></div>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://varkai.com">Designed by VarKai,</a>
        <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
    </div>

    <div class="footer_slogan">
        <span></span>
    </div>
</footer>
    <script src="wildabc.github.io/cnblogs/js/jquery-3.5.1.min.js"></script>
<link href="wildabc.github.io/cnblogs/css/fancybox.min.css" rel="stylesheet">
<script src="wildabc.github.io/cnblogs/js/fancybox.min.js"></script>
<script src="wildabc.github.io/cnblogs/js/zozo.js"></script>




</body>

</html>